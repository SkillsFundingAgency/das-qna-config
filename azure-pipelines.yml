    
name: das-qna-config
trigger:
  batch: true
  branches:
    include:
      - "*"

pr: none

workspace:
    clean: all

variables:
  buildConfiguration: 'release'
  buildPlatform: 'anycpu'

  IMAGE_NAME: "apprenticeshipsdevops/das-qna-config"

pool:
  name: "DAS - Continuous Integration"

steps:
- task: Docker@2
  displayName: Login to Docker Hub
  inputs:
    command: login
    containerRegistry: "Apprenticeships DevOps Docker Hub"

- task: Docker@2
  displayName: Build Docker Image
  inputs:
    command: Build
    dockerfile: "src/SFA.DAS.QnA.Config.Web/ClientApp/dockerfile"
    repository: apprenticeshipsdevops/das-qna-config
    tags: |
      $(build.BuildId)
      latest

- task: Docker@2
  displayName: Push Docker Image
  inputs:
    command: Push
    repository: apprenticeshipsdevops/das-qna-config
    tags: $(build.BuildId)

- task: Docker@2
  displayName: Push Web Image Latest if master
  condition: and(succeeded(), eq(variables['Build.SourceBranch'], 'refs/heads/master'))
  inputs:
    repository: apprenticeshipsdevops/das-qna-config
    tags: latest

- task: CopyFiles@2
  displayName: "Copy Files to: $(build.artifactstagingdirectory)"
  inputs:
    contents: |
      azure/**
    targetFolder: "$(build.artifactstagingdirectory)/publish"
    overWrite: true

- task: PublishBuildArtifacts@1
  displayName: "Publish Artifact"
  inputs:
    pathToPublish: "$(build.artifactstagingdirectory)/publish"


