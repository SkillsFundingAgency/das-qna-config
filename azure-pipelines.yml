    
name: das-qna-config
trigger:
  batch: true
  branches:
    include:
      - "*"

pr: none

workspace:
    clean: all

variables:
  buildConfiguration: 'release'
  buildPlatform: 'anycpu'

pool:
  name: "DAS - Continuous Integration"

steps:
- task: gittools.gitversion-preview.gitversion-task.GitVersion@5
  displayName: GitVersion
  inputs:
    configFilePath: GitVersion.yml
    updateAssemblyInfo: true

- task: Docker@2
  displayName: Login to Docker Hub
  inputs:
    command: login
    containerRegistry: "Apprenticeships DevOps Docker Hub"

- task: Docker@2
  displayName: Build Docker Image
  inputs:
    command: build
    dockerfile: 'src/SFA.DAS.QnA.Config.Web/ClientApp/dockerfile'
    repository: apprenticeshipsdevops/das-qna-config
    tags: |
      $(build.buildnumber)
      latest

- task: Docker@2
  displayName: Push Docker Image
  inputs:
    command: push
    repository: apprenticeshipsdevops/das-qna-config
    tags: $(build.buildnumber)

- task: Docker@2
  displayName: Push Web Image Latest if master
  condition: and(succeeded(), eq(variables['Build.SourceBranch'], 'refs/heads/master'))
  inputs:
    command: push
    repository: apprenticeshipsdevops/das-qna-config
    tags: latest

